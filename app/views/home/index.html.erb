<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
          <div class="col-md-3">
              <div class="widget style1 navy-bg">
                  <div class="row">
                      <div class="col-xs-4">
                          <i class="fa fa-users fa-5x"></i>
                      </div>
                      <div class="col-xs-8 text-right">
                          <span>Inquilinos</span>
                          <h2 class="font-bold"><%=@inquilinos.count%></h2>
                      </div>
                  </div>
              </div>
          </div>
          <div class="col-md-3">
              <div class="widget style1 lazur-bg">
                  <div class="row">
                      <div class="col-xs-4">
                          <i class="fa fa-building fa-5x"></i>
                      </div>
                      <div class="col-xs-8 text-right">
                          <span> Propiedades</span>
                          <h2 class="font-bold"><%= @propiedads.count%></h2>
                      </div>
                  </div>
              </div>
          </div>
          <div class="col-md-3">
              <div class="widget style1 yellow-bg">
                  <div class="row">
                      <div class="col-xs-4">
                          <i class="fa fa-handshake-o fa-5x"></i>
                      </div>
                      <div class="col-xs-8 text-right">
                          <span> Rentas activas</span>
                          <h2 class="font-bold"><%= rentas_activas.count%></h2>
                      </div>
                  </div>
              </div>
          </div>
          <div class="col-md-3">
              <div class="widget style1 red-bg">
                  <div class="row">
                      <div class="col-xs-4">
                          <i class="fa fa-refresh fa-5x"></i>
                      </div>
                      <div class="col-xs-8 text-right">
                          <span> Rentas a vencer</span>
                          <h2 class="font-bold"><%= rentas_por_vencer.count%></h2>
                      </div>
                  </div>
              </div>
          </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                  <div class="ibox-title">
                      <h5>Ingresos</h5>
                      <div class="ibox-tools">
                          <a class="collapse-link">
                              <i class="fa fa-chevron-up"></i>
                          </a>
                          <a class="close-link">
                              <i class="fa fa-times"></i>
                          </a>
                      </div>
                  </div>
                    <div class="ibox-content">
                        <div>
                                <span class="pull-right text-right">
                                  <h1 class="m-b-xs">$ <%= @ingresoR %></h1>
                                  <h3 class="font-bold no-margins">
                                      Recibido hasta el momento
                                  </h3>
                                  <small>por pagos registrados</small>
                                </span>
                            <h1 class="m-b-xs">$ <%= @ingresoT %></h1>
                            <h3 class="font-bold no-margins">
                                Ingreso anual esperado
                            </h3>
                            <small>por rentas</small>
                        </div>

                        <div>
                            <canvas id="lineChart" height="70"></canvas>
                        </div>



                    </div>
                </div>
            </div>
        </div>



        <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Pagos del mes y adelantados</h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <table class="table table-hover no-margins">
                            <thead>
                            <tr>
                                <th>Estado</th>
                                <th>Dia de Pago</th>
                                <th>Mes</th>
                                <th>Inquilino</th>
                                <th>Propiedad</th>
                                <th>Mensualidad</th>
                                <th>Monto</th>
                                <th>Balance</th>
                                <th>Acciones</th>
                            </tr>
                            </thead>
                            <tbody>
                              <%  if pagos_atrasados.size > 0  %>
                              <%  pagos_atrasados.each do |at|  %>
                              <% if at["dia"] <  Time.now.strftime("%d").to_i %>
                              <tr>
                                  <td><span class="label label-danger">Atrasado</span> </td>
                                  <td><i class="fa fa-clock-o"></i> <%=at["dia"]%> </td>
                                  <td> <%=at["mes"].to_date.month%></td>
                                  <td> <%=get_inquilinos(at["inquilino_id"]).nombre %></td>
                                  <td> <%=get_propiedads(at["propiedad_id"]).nombre%></td>
                                  <td> <%=at["costo"]%></td>
                                  <td> N.E</td>
                                  <td> <%=getBalance(at)%></td>
                                  <td><%= link_to "Pagar", edit_pago_path(at["pid"]), class: "btn btn-xs btn-primary" %></td>
                              </tr>
                                <%end%>

                              <% if (at["dia"] -10)  <=  Time.now.strftime("%d").to_i && at["dia"] > Time.now.strftime("%d").to_i %>
                              <tr>
                                  <td><span class="label label-warning">Proximo</span> </td>
                                  <td><i class="fa fa-clock-o"></i> <%=at["dia"]%> </td>
                                  <td> <%=at["mes"].to_date.month%></td>
                                  <td> <%=get_inquilinos(at["inquilino_id"]).nombre %></td>
                                  <td> <%=get_propiedads(at["propiedad_id"]).nombre%></td>
                                  <td> <%=at["costo"]%></td>
                                  <td> N.E</td>
                                  <td> <%=getBalance(at)%></td>

                                  <td><%= link_to "Pagar", edit_pago_path(at["pid"]), class: "btn btn-xs btn-primary" %></td>
                              </tr>
                            <%end%>
                            <%end%>
                            <%end%>
                            <%  pagos_hechos.each do |hecho|  %>
                            <tr>
                              <% if hecho["monto"] < hecho["costo"]%>
                                <td><span class="label label-success">Parcial</span> </td>
                                <td><i class="fa fa-clock-o"></i> <%=hecho.dia%> </td>
                                <td> <%=hecho["mes"].to_date.month%></td>
                                <td> <%=get_inquilinos(hecho.inquilino_id).nombre %></td>
                                <td> <%=get_propiedads(hecho.propiedad_id).nombre%></td>
                                <td> <%=hecho["costo"]%></td>
                                <td> <%=hecho["monto"]%></td>
                                <td> <%=getBalance(hecho)%></td>
                                <td><%= link_to "Borrar", pago_path(hecho["pid"]), method: :delete,
                                                                  data: { confirm: "¿Estas seguro que quieres borrar este pago?"},
                                                                  class: "btn btn-xs btn-danger" %></td>
                            </tr>

                                <% else%>
                                <td><span class="label label-primary">Pagado</span> </td>
                                <td><i class="fa fa-clock-o"></i> <%=hecho.dia%> </td>
                                <td> <%=hecho["mes"].to_date.month%></td>
                                <td> <%=get_inquilinos(hecho.inquilino_id).nombre %></td>
                                <td> <%=get_propiedads(hecho.propiedad_id).nombre%></td>
                                <td> <%=hecho["costo"]%></td>
                                <td> <%=hecho["monto"]%></td>
                                <td> <%=getBalance(hecho)%></td>
                                <td><%= link_to "Borrar", pago_path(hecho["pid"]), method: :delete,
                                                                  data: { confirm: "¿Estas seguro que quieres borrar este pago?"},
                                                                  class: "btn btn-xs btn-danger" %></td>
                            </tr>
                              <%end%>
                            <%end%>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>


    </div>
    <% content_for :javascript do %>

    <script type="text/javascript">

    $(function() {

        $(".bar_dashboard").peity("bar", {
            fill: ["#1ab394", "#d7d7d7"],
            width: 100
        })

        var lineData = {
            labels: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre','Diciembre'],
            datasets: [
                {
                    label: "Ingresos Esperados",
                    backgroundColor: "rgba(26,179,148,0.5)",
                    borderColor: "rgba(26,179,148,0.7)",
                    pointBackgroundColor: "rgba(26,179,148,1)",
                    pointBorderColor: "#fff",
                    data: [<%=@ingreso1 %>, <%=@ingreso2 %>, <%=@ingreso3 %>, <%=@ingreso4 %>, <%=@ingreso5 %>, <%=@ingreso6 %>, <%=@ingreso7 %>, <%=@ingreso8 %>, <%=@ingreso9 %>, <%=@ingreso10 %>,<%=@ingreso11 %> ,<%=@ingreso12 %>]
                },
                {
                    label: "Ingresos Reales",
                    backgroundColor: "rgba(54, 124, 237, 0.5)",
                    borderColor: "rgba(54, 124, 237, 1)",
                    pointBackgroundColor: "rgba(54, 124, 237, 1)",
                    pointBorderColor: "#fff",
                    data: [<%=@ingresoR1 %>, <%=@ingresoR2 %>, <%=@ingresoR3 %>, <%=@ingresoR4 %>, <%=@ingresoR5 %>, <%=@ingresoR6 %>, <%=@ingresoR7 %>, <%=@ingresoR8 %>, <%=@ingresoR9 %>, <%=@ingresoR10 %>,<%=@ingresoR11 %> ,<%=@ingresoR12 %>]
                }
            ]
        };

        var lineOptions = {
            responsive: true
        };


        var ctx = document.getElementById("lineChart").getContext("2d");
        new Chart(ctx, {type: 'line', data: lineData, options:lineOptions});

    });


    </script>

    <% end %>
